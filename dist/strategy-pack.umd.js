(function(S){typeof define=="function"&&define.amd?define(S):S()})(function(){"use strict";const S="ll-strategy-dashboard-",L="ll-strategy-view-";var f=(e=>(e.equal="equal",e.in="in",e.greater_than="greater_than",e.lower_than="lower_than",e.is_null="is_null",e.is_numeric="is_numeric",e))(f||{});const V=e=>!e.disabled_by&&!e.hidden_by,x=(e,n,t)=>{const i=parseFloat(n),a=parseFloat(t);switch(e){case f.equal:return n==t;case f.in:if(Array.isArray(t))return t.includes(n);throw Error("Cannot compare. Value must be array.");case f.greater_than:if(isNaN(i)||isNaN(a))throw Error("Cannot compare. One or more values are not numeric");return i>a;case f.lower_than:if(isNaN(i)||isNaN(a))throw Error("Cannot compare. One or more values are not numeric");return i<a;case f.is_null:return!!n;case f.is_numeric:return!isNaN(i)}},q={entity:(e,n,t,i)=>{const a=e.entity_id;return x(i,a,t)},domain:(e,n,t,i)=>{const a=e.entity_id.split(".")[0];return x(i,a,t)},device:(e,n,t,i)=>{const a=e.device_id;return x(i,a,t)},integration:(e,n,t,i)=>{const a=e.platform;return x(i,a,t)},label:(e,n,t,i)=>e.labels.map(o=>x(i,o,t)).indexOf(!0)>0,state:(e,n,t,i)=>{var o;const a=(o=n.states[e.entity_id])==null?void 0:o.state;return x(i,a,t)},attribute:(e,n,t,i)=>{var l;const a=(l=n.states[e.entity_id])==null?void 0:l.attributes;if((c=>!!t&&typeof t=="object"&&t.hasOwnProperty("key")&&t.hasOwnProperty("value"))())return x(i,a[t.key],t.value);throw Error("value is not defined correctly")}},$=(e,n)=>{const t=o=>{const l=o.filter(c=>c.startsWith("sort_")).map(c=>c.replace("sort_",""));return l.push(1/0),l},i=t(e.labels||[])[0],a=t(n.labels||[])[0];return i-a};function R(e){return e!=null}const z={minColumnWidth:150,tabs:[{label:"Control",icon:"mdi:button-pointer",rows:[{domain:"alarm_control_panel",title:"Alarm",card:{type:"tile",entity:"$entity",features:[{type:"alarm-modes",modes:["armed_home","armed_away","armed_night","armed_vacation","armed_custom_bypass","disarmed"]}],tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:"media_player",title:"Media",card:{type:"custom:mushroom-media-player-card",entity:"$entity",use_media_artwork:!0,show_volume_level:!0,use_media_info:!1,collapsible_controls:!0,volume_controls:["volume_set"],media_controls:["play_pause_stop"],tap_action:{action:"toggle"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:"cover",title:"Cover",card:{type:"tile",entity:"$entity",features:[{type:"cover-open-close"}],tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:"vacuum",title:"Vacuum",card:{type:"tile",entity:"$entity",features:[{type:"vacuum-commands",commands:["start_pause","return_home"]}],tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:["switch","input_boolean"],title:"Switch",card:{type:"tile",entity:"$entity",hide_state:!0,color:"amber",tap_action:{action:"toggle"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:["select","input_select"],title:"Select",card:{type:"tile",entity:"$entity",hide_state:!0,color:"primary",features:[{type:"select-options"}],tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:["button","scene"],title:"Button",card:{type:"tile",entity:"$entity",hide_state:!0,color:"primary",tap_action:{action:"toggle"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:"number",title:"Number",card:{type:"tile",entity:"$entity",hide_state:!0,features:[{type:"numeric-input",style:"slider"}],tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}}]},{label:"Stats",icon:"mdi:chart-line",rows:[{domain:"binary_sensor",title:"Alert",filter:{exclude:[{type:"attribute",value:{key:"device_class",value:"motion"}},{type:"attribute",value:{key:"device_class",value:"occupancy"}}]},card:{type:"tile",entity:"$entity",hide_state:!0,color:"primary",tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:"sensor",title:"Sensor",filter:{exclude:[{type:"attribute",value:{key:"device_class",value:"battery"}},{type:"state",comparator:"is_numeric"}]},card:{type:"tile",entity:"$entity",color:"primary",tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}},{domain:"sensor",title:"Graphs",filter:{exclude:[{type:"attribute",value:{key:"device_class",value:"battery"}}],include:[{type:"state",comparator:"is_numeric"}]},card:{type:"custom:mini-graph-card",entities:["$entity"],align_header:"left",align_icon:"left",align_state:"center",font_size:50,font_size_header:12,tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"},card_mod:{style:`.header {
  max-width: 80%;
}
.line--rect,
.fill--rect,
.line--points {
  {% set COLOR = 'grey' %}
  {% if state_attr(config.entities[0].entity,'device_class') in ['date', 'timestamp', 'irradiance', 'distance', 'duration', 'illuminance', 'enum', 'monetary'] %} 
    {% set COLOR = 'grey' %}
  {% elif state_attr(config.entities[0].entity,'device_class') in ['apparent_power', 'battery', 'current', 'energy', 'energy_storage', 'power_factor', 'power', 'voltage'] %} 
    {% set COLOR = 'yellow' %}
  {% elif state_attr(config.entities[0].entity,'device_class') in ['aqi', 'sulphur_dioxide', 'volatile_organic_compounds', 'volatile_organic_compounds_parts', 'atmospheric_pressure', 'carbon_dioxide', 'carbon_monoxide', 'nitrogen_dioxide', 'gas', 'nitrogen_monoxide', 'nitrous_oxide', 'ozone', 'pm1', 'pm10', 'pm25'] %} 
    {% set COLOR = 'green' %}
  {% elif state_attr(config.entities[0].entity,'device_class') in ['pressure', 'reactive_power', 'speed', 'temperature', 'weight', 'wind_speed'] %} 
    {% set COLOR = 'orangered' %}
  {% elif state_attr(config.entities[0].entity,'device_class') in ['moisture', 'ph', 'precipitation', 'precipitation_intensity', 'humidity', 'water', 'volume', 'volume_storage'] %} 
    {% set COLOR = 'royalblue' %}
  {% elif state_attr(config.entities[0].entity,'device_class') in ['data_rate', 'data_size', 'signal_strength', 'frequency', 'sound_pressure'] %}
    {% set COLOR = 'orange' %}
  {% endif %}            
  fill: {{COLOR}};
  stroke: {{COLOR}};
}
`}}}]},{label:"Camera",icon:"mdi:camera",rows:[{domain:"camera",card:{type:"picture-entity",entity:"$entity",tap_action:{action:"more-info"},icon_tap_action:{action:"none"},hold_action:{action:"more-info"}}}]}],areaCardConfig:{aspect_ratio:"35:15",alert_classes:["occupancy"],sensor_classes:["temperature","moisture"]},areaColors:["rgba(42,72,100,0.3)","rgba(234,162,33,0.3)","rgba(214,64,92,0.3)","rgba(190,70,178,0.3)","rgba(145,142,80,0.3)","rgba(12,162,121,0.3)","rgba(76,159,171,0.3)","rgba(147,72,26,0.3)"]},C=(e,n,t,i,a)=>{const o=[],l=[];return e.forEach(c=>{var d;const u=((d=(a||{})[c.entity_id])==null?void 0:d.card)||n.card,m=Object.entries(u).filter(([_,r])=>JSON.stringify(r).includes("$entity")).map(([_,r])=>{const p=JSON.stringify(r);return[_,JSON.parse(p.replace("$entity",c.entity_id))]});l.push({...u,...Object.fromEntries(m)})}),l.length>0&&(i&&o.push({type:"custom:mushroom-title-card",title:i,subtitle_tap_action:{action:"none"}}),o.push({type:"custom:layout-card",layout_type:"custom:grid-layout",layout:{"grid-template-rows":"auto","grid-template-columns":`repeat(auto-fit, minmax(${t}px, 1fr))`,padding:"0px 10px"},cards:l})),o};class P extends HTMLTemplateElement{static async generate(n,t){var u;const[i,a,o]=await Promise.all([t.callWS({type:"config/entity_registry/list"}),t.callWS({type:"config/device_registry/list"}),t.callWS({type:"config/area_registry/list"})]);return{views:[...o.filter(m=>{var d;return!((d=n.config)!=null&&d.areaBlacklist)||n.config.areaBlacklist.indexOf(m.area_id)==-1}).sort($).map((m,d)=>({strategy:{type:"custom:area-view-strategy",meta:{entities:i,devices:a,areas:o},config:{...z,...n.config||{},area:m.area_id}},title:m.name,path:m.area_id,icon:"mdi:home",type:"panel",subview:!1,visible:d==0})),...((u=n.config)==null?void 0:u.extraViews)||[]]}}}class B extends HTMLTemplateElement{static async generate(n,t){const{config:i,meta:a}=n,{area:o,tabs:l,minColumnWidth:c,replaceCards:u,topCards:m,areaColors:d,areaCardConfig:_,areaBlacklist:r}=i;let p=Array(),w=Array(),g=Array();if(a)p=a.entities,w=a.devices,g=a.areas;else{const s=await Promise.all([t.callWS({type:"config/entity_registry/list"}),t.callWS({type:"config/device_registry/list"}),t.callWS({type:"config/area_registry/list"})]);p=s[0],w=s[1],g=s[2]}p=[...p].sort($),w=[...w].sort($),g=[...g].sort($);const D=g.filter(s=>!r||r.indexOf(s.area_id)==-1),A=g.find(s=>s.area_id==o);if(!A)throw Error("No area defined");const W=new Set;for(const s of w)s.area_id===A.area_id&&W.add(s.id);const I={type:"vertical-stack",cards:[{type:"custom:layout-card",layout_type:"custom:grid-layout",layout:{"grid-template-rows":"auto","grid-template-columns":"repeat(auto-fit, minmax(300px, 1fr))"},cards:[]}]},N=D.reduce((s,h,y)=>{const b={..._,type:"area",area:h.area_id,navigation_path:`${h.area_id}#main`};return s.cards[0].cards.push({type:"conditional",conditions:[{condition:"screen",media_query:"(max-width: 1000px)"}],card:{...b,card_mod:{style:`
                  hui-image {
                    opacity: 0.3;
                  }
                  div.navigate {
                    background-color: ${d[y]};
                  }`}}}),s.cards[0].cards.push({type:"conditional",conditions:[{condition:"screen",media_query:"(min-width: 1001px)"}],card:h.area_id==A.area_id?b:{...b,card_mod:{style:`
                        hui-image {
                          opacity: 0.3;
                        }
                        div.navigate {
                          background-color: ${d[y]};
                        }`}}}),s},I);N.cards=[...m||[],...N.cards];const U=s=>s.reduce((h,y)=>{let b=p.filter(V).filter(v=>v.area_id?v.area_id===A.area_id:W.has(v.device_id)).filter(v=>{const T=v.entity_id.split(".")[0];return Array.isArray(y.domain)?y.domain.filter(O=>O==T).length>0:y.domain==T});y.filter&&(b=b.filter(v=>{var O;return(((O=y.filter)==null?void 0:O.include)||[]).reduce((k,E)=>k&&q[E.type](v,t,E.value,E.comparator||f.equal),!0)}),b=b.filter(v=>{var O;return(((O=y.filter)==null?void 0:O.exclude)||[]).reduce((k,E)=>k&&!q[E.type](v,t,E.value,E.comparator||f.equal),!0)}));const J=C(b,y,c,y.title,u);return h.push(...J),h},Array()),j=l.map(s=>{const h=U(s.rows);return h.length>0?{attributes:{label:s.label,icon:s.icon,stacked:!0},card:{type:"vertical-stack",cards:h}}:null}).filter(R),M={type:"custom:tabbed-card",styles:{"--mdc-tab-text-label-color-default":"var(--primary-text-color)","--mdc-tab-color-default":"var(--primary-text-color)"},tabs:j};return{panel:!0,cards:[{type:"vertical-stack",cards:[{type:"conditional",conditions:[{condition:"screen",media_query:"(max-width: 1000px)"}],card:{type:"custom:state-switch",entity:"hash",default:"default",states:{"":{type:"vertical-stack",cards:[N,{type:"custom:gap-card",height:60}]},default:{type:"vertical-stack",cards:[M,{type:"custom:mushroom-chips-card",card_mod:{style:`
                        ha-card { --chip-background: none; }
                        :host {
                          --chip-icon-size: 1em !important;
                          z-index: 2;
                          width: 100%;
                          position: fixed;
                          bottom: 0;
                          margin: 0 !important;
                          padding: 20px;
                          background: var(--app-header-background-color);
                          left: 50%;
                          transform: translateX(-50%);
                        }
                        @media (min-width: 1001px) {
                          :host {
                            display: none;
                          }
                        }`},chips:[{type:"spacer"},{type:"template",icon:"mdi:home",icon_height:"40px",tap_action:{action:"navigate",navigation_path:window.location.pathname}},{type:"spacer"}]},{type:"custom:gap-card",height:60}]}}}},{type:"conditional",conditions:[{condition:"screen",media_query:"(min-width: 1001px)"}],card:{type:"custom:layout-card",layout_type:"custom:grid-layout",layout:{"grid-template-columns":"2fr 3fr","grid-template-areas":"navigation main"},cards:[N,M]}}]}]}}}customElements.define(`${S}area-dashboard-strategy`,P),customElements.define(`${L}area-view-strategy`,B);class F extends HTMLTemplateElement{static async generate(n,t){const{config:i}=n,{minColumnWidth:a,replaceCards:o}=i,[l]=await Promise.all([t.callWS({type:"config/entity_registry/list"})]),c={card:{type:"custom:mini-graph-card",entities:["$entity"],align_header:"left",align_icon:"left",align_state:"center",font_size:50,font_size_header:12,lower_bound:0,upper_bound:100,card_mod:{style:`
              .header {
                max-width: 80%;
              }
              .line--rect,
              .fill--rect,
              .line--points {
                fill: amber;
                stroke: amber;
              }`}}},u=l.filter(V).filter(r=>{var w,g;return r.entity_id.split(".")[0]=="sensor"&&((g=(w=t.states[r.entity_id])==null?void 0:w.attributes)==null?void 0:g.device_class)=="battery"}),m=u.filter(r=>!["mqtt","switchbot"].includes(r.platform)),d=u.filter(r=>["mqtt"].includes(r.platform)),_=u.filter(r=>["switchbot"].includes(r.platform));return{panel:!0,cards:[{type:"vertical-stack",cards:[...m.length>0?C(m,c,a,"Other",o):[],...d.length>0?C(d,c,a,"Zigbee",o):[],..._.length>0?C(_,c,a,"Switchbot",o):[]]}]}}}customElements.define(`${L}battery-view-strategy`,F);class H extends HTMLTemplateElement{static async generate(n,t){const{config:i}=n,{minColumnWidth:a,replaceCards:o}=i,[l]=await Promise.all([t.callWS({type:"config/entity_registry/list"})]),c={card:{type:"tile",entity:"$entity",hide_state:!0,features:[{type:"update-actions",backup:"ask"}]}},u=l.filter(V).filter(r=>{const p=r.entity_id.split(".")[0];return!r.disabled_by&&!r.hidden_by&&p=="update"}),m=u.filter(r=>!["unifi","esphome"].includes(r.platform)),d=u.filter(r=>["unifi"].includes(r.platform)),_=u.filter(r=>["esphome"].includes(r.platform));return{panel:!0,cards:[{type:"vertical-stack",cards:[...m.length>0?C(m,c,a,"Other",o):[],...d.length>0?C(d,c,a,"UniFi",o):[],..._.length>0?C(_,c,a,"ESPHome",o):[]]}]}}}customElements.define(`${L}update-view-strategy`,H)});
